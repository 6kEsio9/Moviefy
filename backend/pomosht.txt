WITH updated_status AS (
  UPDATE watchlist
  SET type = $1
  WHERE filmId = $2 AND userId = $3
	RETURNING *
)
INSERT INTO watchlist (filmId, userId, type)
SELECT 
  $2,
  (SELECT id FROM users WHERE username = $3 LIMIT 1),
  $1
WHERE NOT EXISTS (SELECT 1 FROM updated_status);
